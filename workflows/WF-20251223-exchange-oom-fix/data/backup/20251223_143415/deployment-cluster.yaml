apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "32"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{"reloader.stakater.com/auto":"true"},"labels":{"env":"prod","project":"forex","team":"forex"},"name":"exchange-service","namespace":"forex-prod"},"spec":{"replicas":2,"selector":{"matchLabels":{"app":"exchange-service"}},"template":{"metadata":{"annotations":{"ack.aliyun.com/rds_id":"rm-3nsb71k9219b22611","ack.aliyun.com/white_list_name":"rds_whitelist"},"labels":{"app":"exchange-service","env":"prod","project":"forex","team":"forex"}},"spec":{"automountServiceAccountToken":false,"containers":[{"envFrom":[{"secretRef":{"name":"exchange-service-env"}}],"image":"asia-east2-docker.pkg.dev/uu-prod/uu-prod/forex/exchange-service/exchange-service-rel:231","imagePullPolicy":"Always","livenessProbe":{"failureThreshold":3,"initialDelaySeconds":45,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":10320},"timeoutSeconds":10},"name":"exchange-service","ports":[{"containerPort":10320,"name":"exchange-port"}],"readinessProbe":{"failureThreshold":3,"initialDelaySeconds":45,"periodSeconds":10,"successThreshold":1,"tcpSocket":{"port":10320},"timeoutSeconds":10},"resources":{"limits":{"cpu":"4000m","memory":"6144Mi"},"requests":{"cpu":"1000m","memory":"1024Mi"}},"securityContext":{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":false,"runAsGroup":1000,"runAsNonRoot":true,"runAsUser":1000,"seccompProfile":{"type":"RuntimeDefault"}},"volumeMounts":[{"mountPath":"/forex/log/","name":"log","subPath":"exchange-service"},{"mountPath":"/forex/encrypt/","name":"decryptor","subPath":"c-shared-so-1.23.4"}]}],"initContainers":[{"command":["sh","-c","chown -R 1000:1000 /forex/log/"],"image":"asia-east2-docker.pkg.dev/uu-prod/uu-prod/forex-infra/busybox:1.36","name":"fix-permissions","securityContext":{"runAsUser":0},"volumeMounts":[{"mountPath":"/forex/log/","name":"log","subPath":"exchange-service"}]}],"nodeSelector":{"env":"prod","project":"forex","role":"apps","team":"forex"},"restartPolicy":"Always","volumes":[{"name":"log","persistentVolumeClaim":{"claimName":"forex-cnf-nas-log"}},{"name":"decryptor","persistentVolumeClaim":{"claimName":"forex-cnf-nas-dcpt"}}]}}}}
    reloader.stakater.com/auto: "true"
  creationTimestamp: "2025-08-27T12:46:54Z"
  generation: 42
  labels:
    env: prod
    project: forex
    team: forex
  name: exchange-service
  namespace: forex-prod
  resourceVersion: "111429475"
  uid: 2f53bbc9-f0eb-4459-9b24-7a5f3e531c23
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: exchange-service
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        ack.aliyun.com/rds_id: rm-3nsb71k9219b22611
        ack.aliyun.com/white_list_name: rds_whitelist
        kubectl.kubernetes.io/restartedAt: "2025-11-05T08:20:44+09:00"
      creationTimestamp: null
      labels:
        app: exchange-service
        env: prod
        project: forex
        team: forex
    spec:
      automountServiceAccountToken: false
      containers:
      - env:
        - name: STAKATER_EXCHANGE_SERVICE_ENV_SECRET
          value: 0455728aa1c1015356bcea55b64b04370add7312
        envFrom:
        - secretRef:
            name: exchange-service-env
        image: asia-east2-docker.pkg.dev/uu-prod/uu-prod/forex/exchange-service/exchange-service-rel:231
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 3
          initialDelaySeconds: 45
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 10320
          timeoutSeconds: 10
        name: exchange-service
        ports:
        - containerPort: 10320
          name: exchange-port
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          initialDelaySeconds: 45
          periodSeconds: 10
          successThreshold: 1
          tcpSocket:
            port: 10320
          timeoutSeconds: 10
        resources:
          limits:
            cpu: "4"
            memory: 6Gi
          requests:
            cpu: "1"
            memory: 1Gi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 1000
          runAsNonRoot: true
          runAsUser: 1000
          seccompProfile:
            type: RuntimeDefault
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /forex/log/
          name: log
          subPath: exchange-service
        - mountPath: /forex/encrypt/
          name: decryptor
          subPath: c-shared-so-1.23.4
      dnsPolicy: ClusterFirst
      initContainers:
      - command:
        - sh
        - -c
        - chown -R 1000:1000 /forex/log/
        image: asia-east2-docker.pkg.dev/uu-prod/uu-prod/forex-infra/busybox:1.36
        imagePullPolicy: IfNotPresent
        name: fix-permissions
        resources: {}
        securityContext:
          runAsUser: 0
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /forex/log/
          name: log
          subPath: exchange-service
      nodeSelector:
        env: prod
        project: forex
        role: apps
        team: forex
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
      - name: log
        persistentVolumeClaim:
          claimName: forex-cnf-nas-log
      - name: decryptor
        persistentVolumeClaim:
          claimName: forex-cnf-nas-dcpt
status:
  availableReplicas: 2
  conditions:
  - lastTransitionTime: "2025-09-23T02:28:27Z"
    lastUpdateTime: "2025-12-11T02:04:33Z"
    message: ReplicaSet "exchange-service-7846d4765c" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  - lastTransitionTime: "2025-12-18T11:27:20Z"
    lastUpdateTime: "2025-12-18T11:27:20Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  observedGeneration: 42
  readyReplicas: 2
  replicas: 2
  updatedReplicas: 2
